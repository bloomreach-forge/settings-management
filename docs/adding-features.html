<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 16 April 2020 
 | Rendered using BloomReach Forge Maven Skin 3.1.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                  <meta name="Date-Revision-yyyymmdd" content="20200416" />
              <meta http-equiv="Content-Language" content="en" />
      <title>Settings Management &#x2013; Adding configuration options for custom features</title>
  <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-3.1.1.min.css"/>
  <link rel="stylesheet" href="./css/forge-maven-skin-3.1.1.min.css"/>
  <link rel="stylesheet" href="./css/site.css" />
  <link rel="stylesheet" href="./css/print.css" media="print" />
  <link rel="icon" type="image/png" href="./images/skin/logo_64.png" sizes="64x64">

  
  <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-3.1.1.min.js"></script>
  <script type="text/javascript" src="./js/forge-maven-skin-3.1.1.min.js"></script>

    </head>
<body class="topBarDisabled">
                        <a href="https://github.com/bloomreach-forge/settings-management">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
         src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
         alt="Fork me on GitHub">
  </a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
                        <a href="https://bloomreach-forge.github.io">
        <img src="./images/skin/logo.png" alt="BloomReach Forge Logo" />
      </a>
    </div>
    <div class="pull-left">              <div id="bannerLeft">    <h1>Bloomreach Settings Management Plugin</h1>
    </div>
              </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
                            <div class="links">
      <a href="https://documentation.bloomreach.com">documentation.bloomreach.com</a>
      <a href="https://developers.bloomreach.com">developers.bloomreach.com</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: 16 April 2020  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li class="nav-header">Main</li>
              <li>  <a href="index.html" title="Welcome">  <span class="none"></span>  Welcome</a>  </li>
        <li>  <a href="screenshots.html" title="Screenshots">  <span class="none"></span>  Screenshots</a>  </li>
        <li>  <a href="features.html" title="Functional coverage">  <span class="none"></span>  Functional coverage</a>  </li>
        <li>  <a href="release-notes.html" title="Release notes">  <span class="none"></span>  Release notes</a>  </li>
                  <li class="nav-header">Usage</li>
              <li>  <a href="install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
        <li class="active">  <a href="#"><span class="none"></span>Adding custom features</a>
  </li>
                  <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                    <li>  <a href="project-info.html" title="Project Information">  <span class="icon-chevron-right"></span>  Project Information</a>  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
              <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">  <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />  </a>
          </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    <!--
  Copyright 2013-2020 Bloomreach Inc. (https://www.bloomreach.com)

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  -->
<div class="section">
<h2><a name="Adding_configuration_options_for_custom_features"></a>Adding configuration options for custom features</h2>
<p>Adding or extending the configuration panels with your own Bloomreach CMS plugin configuration is quite easy. It basically consists of three steps:</p>
<ul>

<li>Create a new Maven project (or add an existing module to your project/plugin)</li>
<li>Add the required dependencies</li>
<li>Create a Wicket Model wrapping the JCR node that contains the configuration</li>
<li>Create a Wicket Panel for displaying the fields in the settings management panel</li>
<li>Adding the new panel to one of the existing categories (or to a new category)</li>
</ul>
<div class="section">
<h3><a name="Add_the_API_dependency_to_your_project"></a>Add the API dependency to your project</h3>
<p>Add the frontend api to your custom feature module.</p>

<div>
<div>
<pre class="source">&lt;dependency&gt;
  &lt;groupId&gt;org.bloomreach.forge.settingsmanagement&lt;/groupId&gt;
  &lt;artifactId&gt;bloomreach-settingsmanagement-frontend-api&lt;/artifactId&gt;
  &lt;version&gt;3.0.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div>

<p>Select the correct version for your project. See the <a href="release-notes.html">release notes</a> for more information on which version is applicable.</p></div>
<div class="section">
<h3><a name="Creating_a_Wicket_Model"></a>Creating a Wicket Model</h3>
<p>Make sure the newly created Java class implement the <i>CMSFeatureConfig</i> interface.</p>
<p>See the example below for a real-life code sample of an object wrapping the User management JCR configuration node.</p>

<div>
<div>
<pre class="source">public class UserManagementConfig implements CMSFeatureConfig {

    private final static Logger log = LoggerFactory.getLogger(UserManagementConfig.class);
    private Boolean userCreationEnabled;
    private transient Node node;

    public UserManagementConfig(Node configNode) {
        init(configNode);
    }

    private void init(Node configNode){
        this.node = configNode;
        try {
            if(node.hasProperty(ListUsersPlugin.USER_CREATION_ENABLED_KEY)) {
                userCreationEnabled = node.getProperty(ListUsersPlugin.USER_CREATION_ENABLED_KEY).getBoolean();
            } else {
                //default
                userCreationEnabled = true;
            }
        } catch (RepositoryException e) {
            log.error(&quot;Error: {}&quot;, e);
        }
    }

    public Boolean isUserCreationEnabled() {
        return userCreationEnabled;
    }

    public void setUserCreationEnabled(final Boolean userCreationEnabled) {
        this.userCreationEnabled = userCreationEnabled;
    }

    @Override
    public void save() throws RepositoryException {
        node.setProperty(ListUsersPlugin.USER_CREATION_ENABLED_KEY, userCreationEnabled);
        node.getSession().save();
    }

}
</pre></div></div>

<p>Now that we have the simple object in place that maps to the JCR node we need to create a DetachableModel for our Wicket Panel.</p>

<div>
<div>
<pre class="source">public class UserManagementConfigModel extends LoadableDetachableConfigModel&lt;UserManagementConfig&gt; {

    public static final String USER_MANAGEMENT_CONFIG_MODEL_PATH = &quot;/hippo:configuration/hippo:frontend/cms/cms-admin/users&quot;;

    @Override
    protected UserManagementConfig load() {
        return new UserManagementConfig(getConfigNode(USER_MANAGEMENT_CONFIG_MODEL_PATH));
    }
}
</pre></div></div>
</div>
<div class="section">
<h3><a name="Creating_the_Wicket_Panel"></a>Creating the Wicket Panel</h3>

<div>
<div>
<pre class="source">public class UserManagementConfigPanel extends FeatureConfigPanel {

    private UserManagementConfigModel userManagementConfigModel;

    public UserManagementConfigPanel(IPluginContext context, IPluginConfig config) {
        super(context, config, new ResourceModel(&quot;title&quot;));

        userManagementConfigModel = new UserManagementConfigModel();

        RadioGroup allowUserCreationRadioGroup =
            new RadioGroup(&quot;userlist-allow-usercreation&quot;, new PropertyModel(userManagementConfigModel,&quot;userCreationEnabled&quot;));

        allowUserCreationRadioGroup.add(new Radio(&quot;usercreation-disabled&quot;,new Model(Boolean.FALSE)));
        allowUserCreationRadioGroup.add(new Radio(&quot;usercreation-enabled&quot;,new Model(Boolean.TRUE)));
        add(allowUserCreationRadioGroup);
    }

    public void save() {
        UserManagementConfig userManagementConfig = userManagementConfigModel.getObject();

        try {
            userManagementConfig.save();
        } catch (RepositoryException e) {
            error(&quot;An error occurred while trying to save event log configuration: &quot; + e);
        }
    }

    public void cancel() {
        // do nothing.
    }
}
</pre></div></div>

<p>And adding the markup for our panel.</p>

<div>
<div>
<pre class="source">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:wicket=&quot;http://wicket.apache.org&quot;&gt;
&lt;wicket:extend&gt;
    &lt;div class=&quot;settings-formfield-group&quot;&gt;
        &lt;div wicket:id=&quot;userlist-allow-usercreation&quot;&gt;
            &lt;label class=&quot;settings-formfield-label&quot;&gt;&lt;wicket:message key=&quot;user-creation-cms&quot;/&gt;&lt;/label&gt;
            &lt;div class=&quot;settings-formfield-radio&quot;&gt;
                &lt;input type=&quot;radio&quot; wicket:id=&quot;usercreation-enabled&quot;/&gt;&lt;label&gt;&lt;wicket:message key=&quot;user-creation-on&quot;/&gt;&lt;/label&gt;
            &lt;/div&gt;
            &lt;div class=&quot;settings-formfield-radio&quot;&gt;
                &lt;input type=&quot;radio&quot; wicket:id=&quot;usercreation-disabled&quot;/&gt;&lt;label&gt;&lt;wicket:message key=&quot;user-creation-off&quot;/&gt;&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/wicket:extend&gt;
&lt;/html&gt;
</pre></div></div>
</div>
<div class="section">
<h3><a name="Adding_the_configuration"></a>Adding the configuration</h3>
<p>Be sure to create node /hippo:configuration/hippo:frontend/cms/cms-admin/settings/tabconfig/security/usermanagement</p>
<p>This node is bootstrapped by a yaml file, e.g. at repository-data/application/src/main/resources/hcm-config/configuration/admin/usermanagement.yaml:</p>

<div>
<div>
<pre class="source">definitions:
  config:
    /hippo:configuration/hippo:frontend/cms/cms-admin/settings/tabconfig/security/usermanagement:
      jcr:primaryType: frontend:pluginconfig
      featureConfigClass: org.onehippo.forge.settings.management.config.usermanagement.UserManagementConfigPanel
      sequence: 1.0
</pre></div></div>

<p>As you can see you can control the order of your item in an existing category by changing the sequence property of the node.</p></div></div>
    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2013&#x2013;2020
                    <a href="https://www.bloomreach.com">BloomReach Inc.</a>.
              
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

